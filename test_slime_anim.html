<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>动画测试：杂音微粒 (Slime)</title>
<style>
    body {
        background-color: #1a1a1a;
        color: #fff;
        font-family: sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh;
        margin: 0;
    }

    .test-stage {
        width: 800px;
        height: 400px;
        border: 2px solid #444;
        background-color: #000;
        position: relative;
        background-size: cover;
        overflow: hidden;
    }

    /* === 目标 === */
    .target-ally {
        width: 150px;
        height: 150px;
        position: absolute;
        left: 200px;
        bottom: 50px;
        background-image: url('assets/Roles/percussionist.png');
        background-size: contain;
        background-repeat: no-repeat;
        background-position: center bottom;
        transition: filter 0.1s, transform 0.1s;
    }

    /* === 怪物：杂音微粒 === */
    .sprite-enemy {
        width: 200px; 
        height: 200px;
        position: absolute;
        right: 150px;
        bottom: 50px;
        background-image: url('assets/Enemies/slime.png');
        background-size: contain;
        background-repeat: no-repeat;
        background-position: center bottom;
        z-index: 10;
        transform-origin: center bottom;
    }

    /* === 史莱姆撞击动画 (优化节奏版) === */
    /* 
       动作拆解：
       1. 深度蓄力 (Deep Squash): 0% - 50% 缓慢压扁，积攒爆发力
       2. 弹射启动 (Launch): 50% - 60% 瞬间拉长并冲出
       3. 撞击瞬间 (Impact): 60% 触碰目标并爆发
       4. 滞留与回弹: 60% - 100% 撞击后停留并快速弹回
    */
    @keyframes slimeMove {
        0% { transform: translateX(0) scale(1, 1); }
        
        /* 0% - 50%: 缓慢深度压扁，向后挪一点点增加爆发感 */
        50% { transform: translateX(30px) scale(1.4, 0.6); filter: brightness(1.1); } 
        
        /* 50% - 60%: 极速拉伸冲刺 */
        55% { transform: translateX(-100px) scale(0.7, 1.5); }

        /* 60%: 撞击点 */
        60% { transform: translateX(-300px) scale(1.2, 0.8); filter: brightness(1.3); }
        
        /* 70%: 撞击后的挤压滞留 */
        70% { transform: translateX(-290px) scale(1.1, 0.9); }

        /* 100%: 快速弹回原位 */
        100% { transform: translateX(0) scale(1, 1); }
    }

    @keyframes slimeSequence {
        0% { background-image: url('assets/Enemies/slime.png'); }
        
        /* 蓄力全程保持原样 */
        45% { background-image: url('assets/Enemies/slime.png'); }
        
        /* 冲刺开始切换 */
        50% { background-image: url('assets/Enemies/slime_attack_1.png'); }
        
        /* 撞击时刻切换 */
        60% { background-image: url('assets/Enemies/slime_attack_2.png'); }
        
        /* 保持攻击状态直到开始回弹 */
        75% { background-image: url('assets/Enemies/slime_attack_2.png'); }

        /* 归位前换回初始贴图 */
        90% { background-image: url('assets/Enemies/slime.png'); }
        100% { background-image: url('assets/Enemies/slime.png'); }
    }

    .anim-slime-atk {
        animation: 
            slimeMove 1.0s cubic-bezier(0.45, 0.05, 0.55, 0.95), /* 更平滑的曲线 */
            slimeSequence 1.0s steps(1); 
    }

    /* 受击动画 */
    .anim-hit { animation: shakeHit 0.3s ease-out; }
    @keyframes shakeHit {
        0% { filter: brightness(2) sepia(1) hue-rotate(-50deg) saturate(3); transform: translateX(-10px); }
        50% { transform: translateX(5px); }
        100% { filter: none; transform: translateX(0); }
    }

    .controls { margin-top: 20px; }
    button { padding: 10px 30px; font-size: 18px; cursor: pointer; background: #2ecc71; color: white; border: none; border-radius: 4px; }
    button:hover { background: #27ae60; }
    
    #preload { display: none; }
</style>
</head>
<body>

    <div class="test-stage">
        <div id="target-unit" class="target-ally"></div>
        <div id="test-enemy" class="sprite-enemy"></div>
    </div>

    <div class="controls">
        <button onclick="playAnim()">测试撞击 (Tackle)</button>
    </div>

    <div id="preload">
        <img src="assets/Enemies/slime_attack_1.png">
        <img src="assets/Enemies/slime_attack_2.png">
        <img src="assets/vfx/vfx_heavy_hit.png">
    </div>

    <script>
        function playAnim() {
            const enemy = document.getElementById('test-enemy');
            const target = document.getElementById('target-unit');
            
            enemy.classList.remove('anim-slime-atk');
            void enemy.offsetWidth;
            enemy.classList.add('anim-slime-atk');

            // 撞击点现在在 60% (总长1.0s，即0.6s处)
            setTimeout(() => {
                target.classList.remove('anim-hit');
                void target.offsetWidth;
                target.classList.add('anim-hit');
            }, 600);
        }
    </script>
</body>
</html>