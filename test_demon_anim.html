<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>动画测试：寂静指挥家 (Demon Boss)</title>
<style>
    body {
        background-color: #1a1a1a;
        color: #fff;
        font-family: sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh;
        margin: 0;
    }

    .test-stage {
        width: 800px;
        height: 400px;
        border: 2px solid #444;
        background-color: #000;
        position: relative;
        background-size: cover;
        overflow: hidden;
    }

    /* === 目标 === */
    .target-ally {
        width: 150px;
        height: 150px;
        position: absolute;
        left: 200px;
        bottom: 50px;
        background-image: url('assets/Roles/percussionist.png');
        background-size: contain;
        background-repeat: no-repeat;
        background-position: center bottom;
        transition: filter 0.1s, transform 0.1s;
    }

    /* === Boss：寂静指挥家 === */
    .sprite-enemy {
        width: 300px; /* Boss 大一点 */
        height: 300px;
        position: absolute;
        right: 100px;
        bottom: 30px;
        background-image: url('assets/Enemies/demon.png');
        background-size: contain;
        background-repeat: no-repeat;
        background-position: center bottom;
        z-index: 10;
        /* Boss 不移动，但施法时可能会有呼吸感 */
        transition: transform 0.2s; 
    }

    /* === 魔法特效 === */
    .vfx-particle {
        position: absolute;
        pointer-events: none;
        z-index: 20;
        animation: vfxFade 0.6s ease-out forwards;
    }
    @keyframes vfxFade {
        0% { opacity: 0; transform: scale(0.5); }
        20% { opacity: 1; transform: scale(1.5); }
        100% { opacity: 0; transform: scale(2.0); }
    }

    /* === Boss 施法动画 (序列帧 + 轻微浮动) === */
    @keyframes demonCast {
        0% { transform: scale(1) translateY(0); }
        
        /* 20%: 举起手 (Attack 1) - 身体上浮蓄力 */
        20% { transform: scale(1.05) translateY(-25px); filter: brightness(1.2); }
        
        /* 50%: 挥下 (Attack 2) - 爆发瞬间 */
        50% { transform: scale(1.1) translateY(15px); filter: brightness(1.5) drop-shadow(0 0 15px purple); }
        
        /* 50-90%: 保持在下方位置 (Attack 3) - 展示压制感 */
        90% { transform: scale(1.05) translateY(10px); }
        
        100% { transform: scale(1) translateY(0); }
    }

    @keyframes demonSequence {
        0% { background-image: url('assets/Enemies/demon.png'); }
        
        /* 准备阶段 */
        10% { background-image: url('assets/Enemies/demon_attack_1.png'); }
        
        /* 挥动瞬间 */
        40% { background-image: url('assets/Enemies/demon_attack_2.png'); }
        
        /* 释放后的余韵 (Attack 3) - 大幅延长 */
        55% { background-image: url('assets/Enemies/demon_attack_3.png'); }
        
        95% { background-image: url('assets/Enemies/demon.png'); }
        100% { background-image: url('assets/Enemies/demon.png'); }
    }

    .anim-demon-cast {
        animation: 
            demonCast 1.5s cubic-bezier(0.4, 0, 0.2, 1), /* 稍长的施法动作 */
            demonSequence 1.5s steps(1); 
    }

    /* 受击动画 */
    .anim-hit { animation: shakeHit 0.5s ease-out; }
    @keyframes shakeHit {
        0% { filter: brightness(2) drop-shadow(0 0 10px purple); transform: translateX(-5px); }
        100% { filter: none; transform: translateX(0); }
    }

    .controls { margin-top: 20px; }
    button { padding: 10px 30px; font-size: 18px; cursor: pointer; background: #8e44ad; color: white; border: none; border-radius: 4px; }
    button:hover { background: #9b59b6; }
    
    #preload { display: none; }
</style>
</head>
<body>

    <div class="test-stage">
        <div id="target-unit" class="target-ally"></div>
        <div id="test-enemy" class="sprite-enemy"></div>
    </div>

    <div class="controls">
        <button onclick="playAnim()">测试 Boss 施法 (Cast)</button>
    </div>

    <div id="preload">
        <img src="assets/Enemies/demon_attack_1.png">
        <img src="assets/Enemies/demon_attack_2.png">
        <img src="assets/Enemies/demon_attack_3.png">
        <img src="assets/vfx/vfx_Boss_wave.png">
    </div>

    <script>
        function playAnim() {
            const enemy = document.getElementById('test-enemy');
            const target = document.getElementById('target-unit');
            
            enemy.classList.remove('anim-demon-cast');
            void enemy.offsetWidth;
            enemy.classList.add('anim-demon-cast');

            // 节奏点：
            // 动画总长 1.5s
            // 施法高潮在 50% (0.75s) -> 这里产生冲击波
            // 我们稍微延迟一点点让特效在挥棒之后到达
            
            setTimeout(() => {
                spawnVFX();
                target.classList.remove('anim-hit');
                void target.offsetWidth;
                target.classList.add('anim-hit');
            }, 750);
        }

        function spawnVFX() {
            const stage = document.querySelector('.test-stage');
            const vfx = document.createElement('img');
            vfx.src = 'assets/vfx/vfx_Boss_wave.png';
            vfx.className = 'vfx-particle';
            
            // 特效直接出现在目标身上
            vfx.style.left = '175px'; // 目标中心 (200 + 150/2 - 100)
            vfx.style.bottom = '25px';
            vfx.style.width = '200px'; 
            
            stage.appendChild(vfx);
            setTimeout(() => vfx.remove(), 600);
        }
    </script>
</body>
</html>