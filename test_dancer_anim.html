<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>动画测试：失衡舞者 (Dancer 3-Stage)</title>
<style>
    body {
        background-color: #1a1a1a;
        color: #fff;
        font-family: sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh;
        margin: 0;
    }

    .test-stage {
        width: 800px;
        height: 400px;
        border: 2px solid #444;
        background-color: #000;
        position: relative;
        background-size: cover;
        overflow: hidden;
    }

    /* === 目标 === */
    .target-ally {
        width: 150px;
        height: 150px;
        position: absolute;
        left: 200px;
        bottom: 50px;
        background-image: url('assets/Roles/percussionist.png');
        background-size: contain;
        background-repeat: no-repeat;
        background-position: center bottom;
        transition: filter 0.1s, transform 0.1s;
    }

    /* === 敌人 === */
    .sprite-enemy {
        width: 250px;
        height: 250px;
        position: absolute;
        right: 150px;
        bottom: 50px;
        background-image: url('assets/Enemies/shihengwuzhe.png');
        background-size: contain;
        background-repeat: no-repeat;
        background-position: center bottom;
        z-index: 10;
        transform-origin: center bottom;
    }

    /* === 特效 === */
    .vfx-particle {
        position: absolute;
        pointer-events: none;
        z-index: 20;
        animation: vfxFade 0.4s ease-out forwards;
    }
    @keyframes vfxFade {
        0% { opacity: 1; transform: scale(0.5); }
        100% { opacity: 0; transform: scale(1.5); }
    }

    /* === 舞者位移动画 (三段式突刺) === */
    @keyframes dancerMove {
        0% { transform: translateX(0) scale(1) skewX(0); }
        
        /* 0-35%: 蓄力 (Attack 1) */
        35% { transform: translateX(30px) scale(0.9) skewX(-10deg); filter: brightness(1.2); } 
        
        /* 35-45%: 极速突进 (Attack 2) */
        /* 中途拉伸，模拟残影 */
        40% { transform: translateX(-120px) scale(1.2, 0.8) skewX(30deg); opacity: 0.9; }
        
        /* 45%: 命中急停 (Attack 3) */
        45% { transform: translateX(-280px) scale(1.1) skewX(0); opacity: 1; } 
        
        /* 45-75%: 攻击定格 (Attack 3 持续展示) */
        /* 稍微前移一点，模拟穿透力 */
        75% { transform: translateX(-300px) scale(1.1); } 
        
        /* 100%: 归位 */
        100% { transform: translateX(0) scale(1); }
    }

    /* === 舞者序列帧 === */
    @keyframes dancerSequence {
        0% { background-image: url('assets/Enemies/shihengwuzhe.png'); }
        
        /* 蓄力阶段: Attack 1 */
        5% { background-image: url('assets/Enemies/shihengwuzhe_attack_1.png'); }
        
        /* 突进开始瞬间 (35%): 切换 Attack 2 */
        35% { background-image: url('assets/Enemies/shihengwuzhe_attack_2.png'); }
        
        /* 命中瞬间 (45%): 切换 Attack 3 (终结姿态) */
        45% { background-image: url('assets/Enemies/shihengwuzhe_attack_3.png'); }
        
        /* 归位前切回站立 */
        85% { background-image: url('assets/Enemies/shihengwuzhe.png'); }
        100% { background-image: url('assets/Enemies/shihengwuzhe.png'); }
    }

    .anim-dancer-attack {
        animation: 
            dancerMove 1.0s cubic-bezier(0.2, 0.8, 0.2, 1),
            dancerSequence 1.0s steps(1); 
    }

    /* 受击动画 */
    .anim-hit { animation: shakeHit 0.4s ease-out; }
    @keyframes shakeHit {
        0% { filter: brightness(2) drop-shadow(0 0 10px red); transform: translateX(-5px); }
        100% { filter: none; transform: translateX(0); }
    }

    .controls { margin-top: 20px; }
    button { padding: 10px 30px; font-size: 18px; cursor: pointer; background: #9b59b6; color: white; border: none; border-radius: 4px; }
    button:hover { background: #8e44ad; }
    
    #preload { display: none; }
</style>
</head>
<body>

    <div class="test-stage">
        <div id="target-unit" class="target-ally"></div>
        <div id="test-enemy" class="sprite-enemy"></div>
    </div>

    <div class="controls">
        <button onclick="playAnim()">测试舞者攻击 (3-Stage)</button>
    </div>

    <div id="preload">
        <img src="assets/Enemies/shihengwuzhe_attack_1.png">
        <img src="assets/Enemies/shihengwuzhe_attack_2.png">
        <img src="assets/Enemies/shihengwuzhe_attack_3.png">
        <img src="assets/vfx/vfx_Sharp_Slash.png">
    </div>

    <script>
        function playAnim() {
            const enemy = document.getElementById('test-enemy');
            const target = document.getElementById('target-unit');
            
            enemy.classList.remove('anim-dancer-attack');
            void enemy.offsetWidth;
            enemy.classList.add('anim-dancer-attack');

            // 节奏点：
            // 动画总长 1.0s
            // 撞击点在 45% (0.45s)
            
            setTimeout(() => {
                spawnVFX();
                target.classList.remove('anim-hit');
                void target.offsetWidth;
                target.classList.add('anim-hit');
            }, 450);
        }

        function spawnVFX() {
            const stage = document.querySelector('.test-stage');
            const vfx = document.createElement('img');
            vfx.src = 'assets/vfx/vfx_Sharp_Slash.png';
            vfx.className = 'vfx-particle';
            
            vfx.style.left = '225px'; 
            vfx.style.bottom = '75px';
            vfx.style.width = '200px'; 
            
            stage.appendChild(vfx);
            setTimeout(() => vfx.remove(), 400);
        }
    </script>
</body>
</html>